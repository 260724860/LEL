webpackJsonp([13],{"5F+l":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("Xxa5"),i=r.n(s),a=r("exGp"),n=r.n(a),o=r("Dd8w"),c=r.n(o),p=r("QhFP"),d=r("1bjU"),l=r("NYxO"),u={name:"Order",components:{productCard:p.a,headerNav:d.a},data:function(){return{totalPrice:0,isOrderTypePickerShow:!1,orderTypeString:["订货单","退货单"],orderType:0,isExpressTypePickerShow:!1,expressTypeString:["自提","物流"],expressType:0,isAddressPickerShow:!1,addressList:[],addressIndex:0,pickUpInfo:{name:"",phone:"",CarNumber:"",date:null,dateString:"请选择取货日期",time:"请选择取货时间"},isDatePickerShow:!1,isTimePickerShow:!1,minDate:null,minHour:9,maxHour:18,notes:""}},computed:c()({},Object(l.d)(["shoppingCart","address","sysAddress","userInfo"]),{totalCount:{get:function(){var e=0;return this.shoppingCart.forEach(function(t){e+=t.GoodsCount}),e}}}),mounted:function(){var e=this;return n()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.loadShoppingCart(!0);case 2:return t.next=4,e.loadAddress();case 4:return t.next=6,e.loadSysAddress();case 6:e.initTotalPrice(),e.pickUpInfo.name=e.userInfo.accattach.TrueName,e.pickUpInfo.phone=e.userInfo.accattach.Mobile,e.pickUpInfo.CarNumber=e.userInfo.accattach.CarNumber,e.addressList=e.sysAddress,(new Date).getHours()>9?((r=new Date).setDate(r.getDate()+1),e.minDate=r):e.minDate=new Date;case 13:case"end":return t.stop()}},t,e)}))()},methods:c()({},Object(l.b)(["loadShoppingCart","loadAddress","loadSysAddress"]),{initTotalPrice:function(){var e=this;this.totalPrice=0,this.shoppingCart.forEach(function(t){e.totalPrice+=t.GoodsCount*t.Price}),this.totalPrice*=100},showOrderTypePicker:function(){this.isOrderTypePickerShow=!0},onOrderTypeChange:function(e,t,r){this.orderType=r,this.addressList=this.sysAddress,this.addressIndex=0,this.expressType=0},showExpressTypePicker:function(){this.isExpressTypePickerShow=!0},onExpressTypeChange:function(e,t,r){this.expressType=r,this.addressIndex=0,this.addressList=0===this.expressType?this.sysAddress:this.address},showAddressPicker:function(){this.addressList.length>0?this.isAddressPickerShow=!0:this.$router.push("/addressList")},onAddressSelect:function(e,t){this.addressIndex=t,this.isAddressPickerShow=!1},showDatePicker:function(){this.isDatePickerShow=!0},hideDatePicker:function(){this.isDatePickerShow=!1},onDateChange:function(e){var t=new RegExp("/","g");this.pickUpInfo.date=e,this.pickUpInfo.dateString=e.toLocaleDateString(),this.pickUpInfo.dateString=this.pickUpInfo.dateString.replace(t,"-");var r=e.toLocaleDateString(),s=(new Date).toLocaleDateString(),i=new Date;i.setDate(i.getDate()+1);var a=i.toLocaleDateString();if(r===s)this.minHour=13,this.maxHour=18;else if(r===a){(new Date).getHours()<17?(this.minHour=9,this.maxHour=18):(this.minHour=13,this.maxHour=18)}else this.minHour=9,this.maxHour=18;this.hideDatePicker()},showTimePicker:function(){this.isTimePickerShow=!0},hideTimePicker:function(){this.isTimePickerShow=!1},onTimeChange:function(e){this.pickUpInfo.time=e,this.hideTimePicker()},onSubmit:function(){var e=this;return n()(i.a.mark(function t(){var r,s,a,n,o,c,p,d;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.addressList.length){t.next=3;break}return e.$Message.error("请选择收货地址"),t.abrupt("return");case 3:if(r=e.addressList[e.addressIndex].AddressID,s=0===e.orderType?1:2,a=0===e.expressType?2:1,n=e.userInfo.accattach.UserID,0!==e.orderType||0!==e.expressType){t.next=34;break}if(o=e.pickUpInfo.CarNumber,c=e.pickUpInfo.name,p=e.pickUpInfo.phone,d=e.pickUpInfo.dateString,d+="T"+e.pickUpInfo.time+":00.000Z",c){t.next=16;break}return e.$Message.error("请填写取货人"),t.abrupt("return");case 16:if(p){t.next=19;break}return e.$Message.error("请填写联系电话"),t.abrupt("return");case 19:if(o){t.next=22;break}return e.$Message.error("请填写取货车牌"),t.abrupt("return");case 22:if("请选择取货日期"!==e.pickUpInfo.dateString){t.next=25;break}return e.$Message.error("请选择取货日期"),t.abrupt("return");case 25:if("请选择取货时间"!==e.pickUpInfo.time){t.next=28;break}return e.$Message.error("请选择取货时间"),t.abrupt("return");case 28:return t.next=30,e.$request.saveOrder(n,r,e.notes,s,a,o,d,c,p);case 30:t.sent?(e.$toast.success({duration:1500,message:"下单成功"}),e.$router.replace("/index")):e.$toast.fail({duration:1500,message:"下单失败"}),t.next=38;break;case 34:return t.next=36,e.$request.saveOrder(n,r,e.notes,s,a);case 36:t.sent?(e.$toast.success({duration:1500,message:"下单成功"}),e.$router.replace("/index")):e.$toast.fail({duration:1500,message:"下单失败"});case 38:case"end":return t.stop()}},t,e)}))()}})},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"order"},[r("headerNav",{attrs:{title:"确认订单"}}),e._v(" "),r("van-cell-group",[r("van-cell",{attrs:{title:"订单类型",value:e.orderTypeString[e.orderType],"is-link":""},on:{click:e.showOrderTypePicker}}),e._v(" "),r("van-popup",{attrs:{position:"bottom"},model:{value:e.isOrderTypePickerShow,callback:function(t){e.isOrderTypePickerShow=t},expression:"isOrderTypePickerShow"}},[r("van-picker",{attrs:{columns:e.orderTypeString,"default-index":e.orderType},on:{change:e.onOrderTypeChange}})],1),e._v(" "),0===e.orderType?r("van-cell",{attrs:{title:"取货方式",value:e.expressTypeString[e.expressType],"is-link":""},on:{click:e.showExpressTypePicker}}):e._e(),e._v(" "),r("van-popup",{attrs:{position:"bottom"},model:{value:e.isExpressTypePickerShow,callback:function(t){e.isExpressTypePickerShow=t},expression:"isExpressTypePickerShow"}},[r("van-picker",{attrs:{columns:e.expressTypeString,"default-index":e.expressType},on:{change:e.onExpressTypeChange}})],1)],1),e._v(" "),r("div",{staticStyle:{height:"5px"}}),e._v(" "),r("van-cell",{staticClass:"contact-card",attrs:{center:"",border:!1,"is-link":""},on:{click:e.showAddressPicker}},[0===e.addressList.length?[r("strong",[e._v("暂无收货地址，点我去添加")])]:[r("strong",[e._v(e._s(e.addressList[e.addressIndex].name+" "+e.addressList[e.addressIndex].tel))]),e._v(" "),r("div",[e._v(e._s(e.addressList[e.addressIndex].address))])]],2),e._v(" "),r("van-popup",{attrs:{position:"bottom"},model:{value:e.isAddressPickerShow,callback:function(t){e.isAddressPickerShow=t},expression:"isAddressPickerShow"}},[r("van-address-list",{staticClass:"hideSelect",attrs:{list:e.addressList},on:{select:e.onAddressSelect}})],1),e._v(" "),r("div",{staticStyle:{height:"7px"}}),e._v(" "),r("van-cell",{attrs:{title:"商品总量",value:e.totalCount}}),e._v(" "),e._l(e.shoppingCart,function(e,t){return r("div",{key:t,staticClass:"card"},[r("product-card",{attrs:{product:e,isOrder:!0}})],1)}),e._v(" "),r("div",{staticStyle:{height:"5px"}}),e._v(" "),0===e.orderType&&0===e.expressType?r("van-cell-group",[r("van-field",{attrs:{clearable:"",label:"取货人",placeholder:"请输入取货人姓名"},model:{value:e.pickUpInfo.name,callback:function(t){e.$set(e.pickUpInfo,"name",t)},expression:"pickUpInfo.name"}}),e._v(" "),r("van-field",{attrs:{clearable:"",label:"联系电话",placeholder:"请输入联系电话"},model:{value:e.pickUpInfo.phone,callback:function(t){e.$set(e.pickUpInfo,"phone",t)},expression:"pickUpInfo.phone"}}),e._v(" "),r("van-field",{attrs:{clearable:"",label:"取货车牌",placeholder:"请输入取货车牌号"},model:{value:e.pickUpInfo.CarNumber,callback:function(t){e.$set(e.pickUpInfo,"CarNumber",t)},expression:"pickUpInfo.CarNumber"}}),e._v(" "),r("van-cell",{attrs:{title:"取货日期",value:e.pickUpInfo.dateString,"is-link":""},on:{click:e.showDatePicker}}),e._v(" "),r("van-popup",{attrs:{position:"bottom"},model:{value:e.isDatePickerShow,callback:function(t){e.isDatePickerShow=t},expression:"isDatePickerShow"}},[r("van-datetime-picker",{attrs:{type:"date","min-date":e.minDate},on:{confirm:e.onDateChange,cancel:e.hideDatePicker}})],1),e._v(" "),e.pickUpInfo.date?[r("van-cell",{attrs:{title:"取货时间",value:e.pickUpInfo.time,"is-link":""},on:{click:e.showTimePicker}}),e._v(" "),r("van-popup",{attrs:{position:"bottom"},model:{value:e.isTimePickerShow,callback:function(t){e.isTimePickerShow=t},expression:"isTimePickerShow"}},[r("van-datetime-picker",{attrs:{type:"time","min-hour":e.minHour,"max-hour":e.maxHour},on:{confirm:e.onTimeChange,cancel:e.hideTimePicker}})],1)]:e._e()],2):e._e(),e._v(" "),r("div",{staticStyle:{height:"5px"}}),e._v(" "),r("van-cell-group",[r("van-field",{attrs:{label:"备注",type:"textarea",placeholder:"在这里填写备注信息",autosize:""},model:{value:e.notes,callback:function(t){e.notes=t},expression:"notes"}})],1),e._v(" "),r("div",{staticStyle:{height:"50px","background-color":"white"}}),e._v(" "),r("van-submit-bar",{attrs:{price:e.totalPrice,"button-text":"提交订单",label:"实付金额："},on:{submit:e.onSubmit}})],2)},staticRenderFns:[]};var k=r("VU/8")(u,h,!1,function(e){r("QTb9")},"data-v-4ed71e91",null);t.default=k.exports},QTb9:function(e,t){}});
//# sourceMappingURL=13.4a9069ed82809682a818.js.map